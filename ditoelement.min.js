class DitoElement extends HTMLElement{keyName="$key";valueName="$value";eventName="$event";indexAtr="dito-i";packAttrName="dito-pack";timeAtr="dito-t";constructor(){if(super(),this.constructor===DitoElement)throw new Error("DitoElement is an abstract and cannot be instantiated as separate class");this.prepare(),this.defineObservable(),this.saveMethods(),this.$self.cssRenderInProgress=!1,this.$self.renderInProgress=!1,this.$self.debounceRender=this.debounce((e=>{this.$self.renderInProgress=!1,this.render()})),this.$self.debounceCssRender=this.debounce((e=>{this.$self.cssRenderInProgress=!1,this.cssRender()})),this.defineDefaults()}prepare(){}init(){}beforeRender(){}afterRender(e){}beforeCssRender(){}afterCssRender(e){}getDefaults(){}connectedCallback(){document.body.contains(this)&&(this.$self.rendered||(window.__dito.main.firstRendered.set(this),delete window.__dito.main.downloadCheck[this.localName],this.firstRenderBeforeActions(),this.init()),this.queueRender())}defineDefaults(){const e=this.getDefaults()||{},t={append:(e,t)=>{const s=this.getAttribute(e)||"";this.setAttribute(e,s+" "+t.value)},replace:(e,t)=>{this.setAttribute(e,t.value)},add:(e,t)=>{const s=this.getAttribute(e)||"";this.setAttribute(e,s+t.value)}};Object.defineProperty(this.$self,"default",{value:e,writable:!1}),Object.keys(e).forEach(function(s){const i=e[s],n=i.type||"append";t[n]?t[n](s,i):console.error("Attribute create as type `"+n+"` is not supported")}.bind(this))}firstRenderBeforeActions(){const e=this.$self.parent;if(e){(e.$self.toInput.get(this)||[]).forEach((t=>{this.setInput.bind(e)(t,this)}))}this.setCssScope()}setCssScope(){this.setAttribute(this.timeAtr,+new Date),this.setAttribute(this.indexAtr,Array.prototype.indexOf.call(this.parentElement.children,this)),this.$self.path=this.getPath(this),this.$self.css.path=this.pathToCss(this.$self.path)}saveMethods(){this.methods={};Object.getOwnPropertyNames(this.constructor.prototype).forEach(function(e){"function"==typeof this[e]&&"constructor"!=e&&(this.methods[e]=this[e].bind(this))}.bind(this))}queueRender(){this.$self.renderInProgress=!0,this.$self.debounceRender()}clearRenderQueue(){this.$self.renderInProgress=!1,this.$self.debounceRender("clear")}queueCssRender(){this.$self.cssRenderInProgress=!0,this.$self.debounceCssRender()}clearCssRenderQueue(){this.$self.cssRenderInProgress=!1,this.$self.debounceCssRender("clear")}defineObservable(){Object.defineProperty(this,"$",{value:new Proxy({},{tag:this,set(e,t,s){if("$"==t[0])throw new Error("You can't create variables on this.$ starting with `$`, it's a taken prefix");if(s!==e[t]&&this.tag.queueRender(),this.tag.$binded[t]){const{provider:e,receiver:i}=this.tag.$binded[t];e.target.$[e.name]!==s&&(e.target.$[e.name]=s)}return Reflect.set(...arguments)}}),writable:!1}),Object.defineProperty(this,"$binded",{value:{},writable:!1}),Object.defineProperty(this,"$binder",{value:{},writable:!1}),Object.defineProperty(this,"$css",{value:new Proxy({},{tag:this,set(e,t,s){return s!==e[t]&&this.tag.queueCssRender(t),Reflect.set(...arguments)}}),writable:!1}),this.$output||this.defineOutput(this),this.$self||this.defineSelf(this)}defineSelf(e){Object.defineProperty(e,"$self",{value:{attributes:{},actions:{},children:[],binds:{},css:{compiled:!1,indices:[],path:null,rendered:!1,renderInProgress:!1,scoped:null},default:{injected:[]},for:{},forBox:{key:null,value:null,keyName:null,valueName:null},forNodes:[],injected:[],injectedPacks:{},parent:null,path:null,rendered:!1,rendering:!1,scope:{},toBind:[],toInput:new WeakMap,uniqueChildren:[],uniqueNodes:new WeakMap,get:{}},writable:!1})}defineOutput(e){Object.defineProperty(e,"$output",{value:{},writable:!1})}compileCSS(){this.__dito.css.content=this.compileCSSExecutables(this.__dito.css.content),this.categorizeCssRules(),this.__dito.compiledCSS=!0}categorizeCssRules(){const e=this.seperateRules(this.__dito.css.content);this.__dito.css.scoped=[],this.__dito.css.global=[],e.forEach((e=>{-1!==e.indexOf("@self")?this.__dito.css.scoped.push({rule:e,index:-1}):this.__dito.css.global.push({rule:e,index:-1})}));const t=window.__dito.main.styleNode.sheet;this.__dito.css.global.forEach((e=>{e.index=t.cssRules.length,t.insertRule(e.rule,t.cssRules.length)}))}seperateRules(e){let t=!1,s=0,i=0;const n=[];for(var r=0;r<e.length;r++){const o=e[r];if(!t&&"{"===o){t=!0;continue}if(!t)continue;if({'"':!0,"'":!0,"`":!0}[o])r=this.getStringEnd(e,o,r+1);else if("{"!==o)if("}"!==o);else{if(i>0){i--;continue}n.push(e.substr(s,r-s+1).trim()),s=r+1,t=!1}else i++}return n}compileCSSExecutables(e){this.__dito.css.actions.executables={};let t=e.indexOf("{{");for(;-1!==t;){const s=e.indexOf("}}",t);if(-1===s)break;const i="exec_"+t+"_"+s;this.__dito.css.actions.executables[i]=e.substr(t+2,s-(t+2)),t=(e=e.replaceAll(e.substr(t,s+2-t),i)).indexOf("{{",t+i.length)}return e}async cssRender(){if(!this.$self.css.renderInProgress&&document.body.contains(this)){this.clearCssRenderQueue(),await this.beforeCssRender();try{this.__dito.compiledCSS||this.compileCSS(),this.$self.css.scoped||(this.$self.css.scoped=JSON.parse(JSON.stringify(this.__dito.css.scoped)),this.$self.css.scoped.forEach((e=>{e.rule=e.rule.replaceAll("@self",this.$self.css.path)})));const e=window.__dito.main.styleNode.sheet;this.$self.css.scoped.forEach((t=>{let s=this.resolveCssExecutables(t.rule);-1===t.index?(t.index=e.cssRules.length,e.insertRule(s,e.cssRules.length)):(e.deleteRule(t.index),e.insertRule(s,t.index))})),await this.afterCssRender({success:!0}),this.$self.css.rendered=!0}catch(e){await this.afterCssRender({success:!1,error:e})}}}resolveCssExecutables(e){const t=this.__dito.css.actions.executables;return Object.keys(t).forEach((s=>{e=e.replaceAll(s,this.getCSSExecuteable(t[s])(...this.getCSSObservablesValues()))})),e}createQueryUp(e,t){if(e==t)return"";const s=Array.prototype.indexOf.call(e.parentElement.children,e)+1;return this.createQueryUp(e.parentElement,t)+" "+e.localName+":nth-child("+s+")"}async render(e=!1){if(!e&&(this.$self.renderInProgress||!document.body.contains(this)))return;if(this.$self.parent&&this.$self.parent.$self.rendering)return void this.queueRender();if(this.clearRenderQueue(),document.body.querySelector(this.localName+" "+this.localName))throw new Error("Custom element "+this.localName+" is recursively called. Stopping the render....");this.$self.rendering=!0;let t=!1;await this.beforeRender(),this.$self.rendered?this.dispatchEvent(window.__dito.events.render):this.dispatchEvent(window.__dito.events.firstrender);try{for(this.__dito.compiledHTML||this.compile(),this.$self.rendered||(this.$self.default.injected=Object.values(this.childNodes),this.innerHTML=this.__dito.html,this.assignChildren(this),this.retrieveBindedValues(),this.renderInjected(this),this.$self.css.rendered||await this.cssRender()),this.$self.forNodes.forEach((e=>{this.actionFor(e)})),this.searchForNotDownloaded(this),this.querySelectorAll(Object.keys(window.__dito.registered).join(", ")).forEach((e=>{e.$self||this.defineSelf(e),e.$self.parent=this}));this.$self.uniqueChildren.length>0;)this.setupUnique(this.$self.uniqueChildren[0]),this.$self.uniqueChildren.splice(0,1);this.$self.children.forEach((e=>{this.actionItem(e)})),this.updateBinds(),Object.keys(this.$self.get).forEach((e=>{document.contains(this.$self.get[e])||delete this.$self.get[e]})),await this.afterRender({success:!0}),this.$self.rendered?this.dispatchEvent(window.__dito.events.rendered):(this.dispatchEvent(window.__dito.events.firstrendered),window.__dito.main.firstRendered.delete(this),this.$self.rendered=!0,window.__dito.main.allDownloaded()),t=!0}catch(e){console.error("There was an error during rendering",e),await this.afterRender({success:!1,error:e})}return this.$self.rendering=!1,t}renderInjected(e){this.querySelectorAll("dito-inject").forEach((e=>{e.$self?.actions?.packs?.length>0?e.$self.actions.packs.forEach((t=>{this.$self.default.injected.forEach(function(s){if(3===s.nodeType)return;s.getAttribute(this.packAttrName)==t?(e.parentElement.insertBefore(s,e),s.removeAttribute(this.packAttrName)):s.querySelectorAll("["+this.packAttrName+'="'+t+'"]').forEach((t=>{e.parentElement.insertBefore(t,e),t.removeAttribute(this.packAttrName)}))}.bind(this))})):this.$self.default.injected.forEach((t=>{e.parentElement.insertBefore(t,e)})),e.remove()}))}setupUnique(e){this.setupEvents(e),this.setupBinds(e),this.setupOutputs(e),this.setupGets(e)}setupGets(e){const t=e.$self?.actions?.gets;if(!t)return;if(t.length>1)throw new Error("You can only retrieve one node once");const s=this.getExecuteable(t[0],e)(...this.getObservablesValues(e));this.$self.get[s]=e}setupOutputs(e){const t=e.$self?.actions?.outputs;t&&t.forEach((t=>{e.$output||this.defineOutput(e),e.$output[t.name]={},e.$output[t.name].emit=function(s){const i=this.$self.parent,n=this.getObservablesKeys.bind(i)(e),r=this.getObservablesValues.bind(i)(e);try{const o=this.getFunction.bind(i)(t.value,e,[this.eventName]).bind(i)(s,...r);this.updatedChangedValues.bind(i)(o,n,r)}catch(s){console.error("Error on output",s)}}.bind(e)}))}setupInputs(e){const t=e.$self?.actions?.inputs;t&&t.forEach((t=>{if(e.$)this.setInput(t,e);else if(window.__dito.registered[e.localName]){const s=this.$self.toInput.get(e);s?this.$self.toInput.set(e,[...s,t]):this.$self.toInput.set(e,[t])}else console.error("Selected node was not made with Dito library and can't have assigned input")}))}setInput(e,t){t.$[e.name]=this.getExecuteable(e.value,t)(...this.getObservablesValues(t))}setupBinds(e){const t=e.$self?.actions?.binds;t&&t.forEach(function(t){void 0!==this.$[t.value]?(e.$?this.setBind(t,e):window.__dito.registered[e.localName]?this.$self.toBind.push({bind:t,node:e}):null!=typeof e[t.name]&&this.setupNativeBind(e,t),this.$self.children.push(e)):console.error("Observable in `"+this.constructor.name+"` doesn't have `"+t.value+"` variable, skipping binding...")}.bind(this))}setupNativeBind(e,t){const{name:s,value:i}=t;e.setAttribute(s,this.$[i]),e.$self||this.defineSelf(e);const n={provider:{target:this,name:i},receiver:{target:e,name:s}};this.$binder[i]?this.$binder[i].push(n):this.$binder[i]=[n],e.$self.binds[s]=n,this.setMutationObserver(e),e.addEventListener("change",function(t){this.$[i]!==e[s]&&void 0!==e[s]&&(this.$[i]=e[s])}.bind(this))}retrieveBindedValues(){this.$self.parent&&this.checkBinds.bind(this.$self.parent)()}checkBinds(){for(var e=0;e<this.$self.toBind.length;e++){const t=this.$self.toBind[e];t.node.$&&(this.setBind(t.bind,t.node),this.$self.toBind.splice(e,1),e--)}}setBind(e,t){const{name:s,value:i}=e;t.$[s]=this.$[i];const n={provider:{target:this,name:i},receiver:{target:t,name:s}};t.$binded[s]=n,this.$binder[i]?this.$binder[i].push(n):this.$binder[i]=[n]}updateBinds(){Object.values(this.$binder).forEach((e=>{e.forEach((e=>{const{receiver:t,provider:s}=e,i=t.target;window.__dito.registered[i.localName]?t.target.$[t.name]=this.$[s.name]:void 0!==i[t.name]?i[t.name]=this.$[s.name]:void 0!==i.getAttribute(t.name)&&i.setAttribute(t.name,this.$[s.name])}))}))}setupEvents(e){const t=e.$self?.actions?.events;t&&t.forEach((t=>{e.addEventListener(t.name,(s=>{const i=this.getObservablesKeys(e),n=this.getObservablesValues(e),r=this.getFunction(t.value,e,[this.eventName])(s,...n);this.updatedChangedValues(r,i,n)}))}))}actionItem(e){const t=e.$self?.actions;t&&(this.actionIf(e,t.ifs||[],"ifs"),this.actionAttrs(e,t.attrs||[],"attrs"),this.actionExecutables(e,t.executables||[],"executables"),this.setupInputs(e))}actionFor(e,t=" "){if(!e.$self.for)throw new Error("Node marked as for doesn't have required values");const{condition:s,anchors:i}=e.$self.for;i.forEach((t=>{e.$self.scope=Object.assign({},e.$self.scope,t.$self.scope),t.$self.forGenerated||(t.$self.forGenerated=[])}));let n,r,o=this.getExecuteable(s,e)(...this.getObservablesValues(e)),l=typeof o;if("string"==l&&(o*=1,l=typeof o),"number"!=l&&"object"!=l||isNaN(o)&&"object"!=l)return console.error("For in `"+this.constructor.name+"` doesn't have iterable value, removing node..."),void e.remove();if("number"==l&&(o=new Array(o).fill(null)),e.$self.for.min){const t=this.getExecuteable(e.$self.for.min,e)(...this.getObservablesValues(e));let s;if(e.$self.for.minDef&&(s=this.getExecuteable(e.$self.for.minDef,e)(...this.getObservablesValues(e))),"number"!=typeof t)throw new Error("For min must be a number");o.length<t&&(o=o.concat(new Array(t-o.length).fill(s)))}n=Object.keys(o),r=Object.values(o);for(var a=0;a<i.length;a++){const s=i[a];!document.body.contains(s)&&i.length>1?(e.$self.for.anchors.splice(a,1),a--):this.renderFor(e,s,r,n,t)}}renderFor(e,t,s,i,n){i.length<t.$self.children.length&&(t.$self.children.splice(i.length).forEach((e=>{this.removeFromChildren(e)})),t.$self.forGenerated.splice(i.length));const r=document.createElement("div"),o=this.__dito.actions;t.$self.forGenerated.forEach(((e,t)=>{const n=i[t],r=s[t];e.forEach((e=>{e.$self.forBox.key=n,e.$self.forBox.value=r,e.render&&e.render(!0)}))}));for(var l=t.$self.children.length;l<i.length;l++){const a=i[l],c=s[l],h=e.cloneNode(!0);t.$self.forGenerated[l]=[],r.appendChild(h),this.iterateOverActions(r,((s,i,n)=>{(n=this.defineChild(n,s,i,o[s][i])).$self.forBox.key=a,n.$self.forBox.value=c,n.$self.forBox.keyName=e.$self.forBox.keyName,n.$self.forBox.valueName=e.$self.forBox.valueName,n.$self.scope=Object.assign({},t.$self.scope,n.$self.scope),t.$self.forGenerated[l].push(n)})),t.parentElement.insertBefore(h,t),e.$self.forBox.anchors.forEach((s=>{const i=h.querySelector(s),r=e.querySelector(s);if(!i||!r)throw new Error("No anchor found!");{const s=this.reconstructForAnchor(i,r);s.$self.children=[];const o=s.$self.parent;s.$self.scope=Object.assign({},o.$self.scope,t.$self.scope),e.$self.forBox.keyName&&(s.$self.scope[e.$self.forBox.keyName]=a),e.$self.forBox.valueName&&(s.$self.scope[e.$self.forBox.valueName]=c),this.actionFor(s.$self.parent,n+"  ")}})),t.$self.children.push(h)}3!==t.nodeType&&this.reconstructForAnchor(t,t)}removeFromChildren(e){for(var t=0;t<this.$self.children.length;t++){const s=this.$self.children[t];e.contains(s)&&(this.$self.children.splice(t,1),t--)}e.remove()}reconstructForAnchor(e,t){const s=document.createTextNode("");e.parentElement.replaceChild(s,e),s.$self=Object.assign({},t.$self);return s.$self.parent.$self.for.anchors.push(s),s}actionExecutables(e,t){if(t.length>1)throw new Error("There can only be one execute script on single node");0!=t.length&&(e.nodeValue=this.getExecuteable(t[0],e)(...this.getObservablesValues(e)))}actionAttrs(e,t){t.forEach((t=>{e.setAttribute(t.name,this.getExecuteable(t.value,e)(...this.getObservablesValues(e)))}))}actionIf(e,t){if(t.length>1)throw new Error("There can only be one if on single node");if(0==t.length)return;e.$self.if||(e.$self.if={condition:t[0],replacement:document.createTextNode("")});const s=e.$self.if.replacement;if(!document.body.contains(s)&&!document.body.contains(e))return;const i=this.getExecuteable(e.$self.if.condition,e)(...this.getObservablesValues(e));i&&!document.body.contains(e)?s.parentElement.replaceChild(e,s):!i&&document.body.contains(e)&&e.parentElement.replaceChild(s,e)}removeNotAssignedChildren(e){const t=Object.keys(this.$self.children);for(var s=0;s<t.length;s++){const i=t[s];e.contains(this.$self.children[i])||delete this.$self.children[i]}}resolveNativeBinds(e){const t=this.$self.nativeChildren,s=Object.keys(t);if(0==s)return;new WeakMap;const i=e.querySelectorAll("["+s.join("], [")+"]");for(let e=i.length-1;e>=0;e--){const s=i[e],n=[];s.getAttributeNames().forEach((e=>{t[e]&&n.push(e)}));let r=null;n.forEach((e=>{const s=t[e];s.node.setAttribute(s.name,this.$[s.value]),r=s.node})),r&&(s.parentElement.insertBefore(r,s),s.remove())}}resolveInjected(e){e.querySelectorAll("dito-inject").forEach((e=>{0!=e.innerHTML.trim().length&&console.error("Inject tag is not empty, everything inside of him will be removed:",e.innerHTML.trim());const t=e.getAttribute(this.packAttrName);if(t){const s=this.$self.injectedPacks[t];if(s){let t=e;s.forEach((e=>{t.parentElement.insertBefore(e,t),t=e}))}}else this.$self.injected.forEach((t=>{e.parentElement.insertBefore(t,e)}));e.remove()}))}getPath(e){const t=this.attributes[this.indexAtr].value,s=this.attributes[this.timeAtr].value,i=e.localName+"@"+t+"@"+s;return this.$self.parent?this.$self.parent.$self.path+"."+i:i}pathToCss(e){let t="";return e.split(".").forEach((e=>{const[s,i,n]=e.split("@");t+=s+"["+this.indexAtr+'="'+i+'"]',t+="["+this.timeAtr+'="'+n+'"]',t+=" "})),t.trim()}assignChildren(e){const t=this.__dito.actions,s=Object.keys(t.fors);s.length>0&&(Object.values(e.querySelectorAll("["+s.join("], [")+"]")).reverse().forEach((e=>{this.defineFor(e)})),this.$self.forNodes=this.$self.forNodes.reverse()),this.iterateOverActions(e,((e,s,i)=>{this.defineChild(i,e,s,t[e][s])}))}defineFor(e){const t=this.__dito.actions,s=[],i=[],n=[];let r,o;if(e.getAttributeNames().forEach((e=>{t.fors[e]&&s.push(e),t.for_keys[e]&&i.push(t.for_keys[e]),t.for_values[e]&&n.push(t.for_values[e]),t.for_mins[e]&&(r=t.for_mins[e]),t.for_min_defs[e]&&(o=t.for_min_defs[e])})),s.length>1)throw new Error("There can only be one `for` on single node");if(i.length>1)throw new Error("There can only be one `key` on single node");if(n.length>1)throw new Error("There can only be one `value` on single node");const l=s[0],a=document.createElement("a");a.setAttribute("dito-anchor",1),a.setAttribute("dito-anchor-alias",l),this.defineSelf(e),this.defineSelf(a),e.removeAttribute(l),i.length>0&&(e.$self.forBox.keyName=i[0]),n.length>0&&(e.$self.forBox.valueName=n[0]),e.$self.forBox.anchors=this.getAnchorPaths(e),this.$self.forNodes.push(e),a.$self.parent=e,e.parentElement.replaceChild(a,e),e.$self.for={condition:t.fors[l],anchors:[a],min:r,minDef:o}}getAnchorPaths(e){const t=[];return e.querySelectorAll("[dito-anchor]").forEach(((s,i)=>{t.push(this.buildPath(s,e)+'[dito-anchor="'+i+'"]'),s.setAttribute("dito-anchor",i)})),t}buildPath(e,t){if(e==t||!e.parentElement)return"";Array.prototype.indexOf.call(e.parentElement.children,e);return this.buildPath(e.parentElement,t)+" "+e.localName}iterateOverActions(e,t){const s=this.__dito.actions;Object.keys(s).forEach(function(i){"fors"!==i&&Object.keys(s[i]).forEach((s=>{e.querySelectorAll("["+s+"]").forEach((e=>{t(i,s,e)}))}))}.bind(this))}defineChild(e,t,s,i){if("executables"===t){const t=document.createTextNode("");e.parentElement.replaceChild(t,e),e=t}else"packs"===t&&e.setAttribute(this.packAttrName,i);e.$self||this.defineSelf(e),e.$self.actions[t]||(e.$self.actions[t]=[]),e.$self.actions[t].push(i),e.attributes&&e.removeAttribute(s);return!{events:!0,binds:!0,outputs:!0,gets:!0}[t]?this.$self.children.push(e):this.$self.uniqueChildren.includes(e)||this.$self.uniqueChildren.push(e),this.$self.uniqueNodes.get(e)||(e.$self.parent=this,e.$self.scope=Object.assign({},this.$self.scope),this.$self.uniqueNodes.set(e,!0)),e}searchForNotDownloaded(e){const t=window.__dito.main.notDownloaded,s=Object.keys(t);if(0==s.length)return;let i=[];e.querySelectorAll(s.join(",")).forEach(((e,s)=>{if(t[e.localName]){const s=t[e.localName];delete t[e.localName],i.push(...window.__dito.main.createRegisterPromise(s.path,s.name,s.version))}})),i.length>0&&async function(){await window.__dito.main.load(i)}.bind(this)()}updatedChangedValues(e,t,s){const i={function:!0,undefined:!0,NaN:!0};t.forEach(((t,n)=>{"$"===t[0]||i[typeof this.$[t]]||i[typeof e[n]]||s[n]===e[n]||(this.$[t]=e[n])}))}compile(){let e=this.__dito.html;e=this.compileFindAndReplace(e,"@b:","b","binds",{hasName:!0}),e=this.compileFindAndReplace(e,"@i:","i","inputs",{hasName:!0}),e=this.compileFindAndReplace(e,"@o:","o","outputs",{hasName:!0}),e=this.compileFindAndReplace(e,"@a:","a","attrs",{hasName:!0}),e=this.compileExecutables(e),e=this.compileFindAndReplace(e,"@e:","e","events",{hasName:!0}),e=this.compileFindAndReplace(e,"@if","if","ifs"),e=this.compileFindAndReplace(e,"@value","v","for_values"),e=this.compileFindAndReplace(e,"@key","k","for_keys"),e=this.compileFindAndReplace(e,"@pack","p","packs"),e=this.compileFindAndReplace(e,"@get","g","gets"),e=this.compileFindAndReplace(e,"@min","m","for_mins"),e=this.compileFindAndReplace(e,"@def-min","di","for_min_defs"),this.__dito.html=this.compileFindAndReplace(e,"@for","for","fors"),this.__dito.compiledHTML=!0}compileFindAndReplace(e,t,s,i,n={}){let r,o=this.__dito.actions[i],{hasName:l,isCss:a,skipValue:c,replace:h}=n;for(a&&(o=this.__dito.css.actions[i]);r=this.getCompiledAttribute(e,t,c,0);){const{name:i,value:n}=r,a=h||s+i.start+"-"+n.end;o[a]=l?{name:e.substr(i.start+t.length,i.end-(i.start+t.length)).trim(),value:e.substr(n.start+1,n.end-1-n.start)}:e.substr(n.start+1,n.end-1-n.start),e=e.replaceAll(e.substr(i.start,n.end-i.start+1),a)}return e}getCompiledAttribute(e,t,s=!1,i=0){let n=e.indexOf(t,i);if(-1===n||0===n&&!/\s/g.test(e[n-1]))return!1;if(s){const e=n+t.length;return{name:{start:n,end:e},value:{start:e,end:e}}}let r=e.indexOf("=",n);if(-1===r)return!1;return{'"':!0,"'":!0,"`":!0}[e[r+1]]?{name:{start:n,end:r},value:{start:r+1,end:this.getStringEnd(e,e[r+1],r+2)}}:(console.error("String wrapper for `"+t+"` in `"+this.constructor.name+"` not found (found letter: `"+e[r+1]+"`), skipping"),this.getCompiledAttribute(e,t,s,r))}getStringEnd(e,t,s=0){let i=e.indexOf(t,s);return"\\"==e[i-1]?this.getStringEnd(test,t,i+1):i}compileExecutables(e){let t=e.indexOf("{{");for(;-1!==t;){let s=e.indexOf("}}",t);if(-1===s)break;const i="exec_"+t+"_"+s;this.__dito.actions.executables[i]=e.substr(t+2,s-(t+2)),t=(e=e.replaceAll(e.substr(t,s+2-t),"<span "+i+"></span>")).indexOf("{{",t+i.length)}return e}getExecuteable(e,t){return new Function(...this.getObservablesKeys(t),"return "+e).bind({})}getCSSExecuteable(e){return new Function(...this.getCSSObservablesKeys(),"return "+e).bind({})}getFunction(e,t,s=[]){const i=this.getObservablesKeys(t);return new Function(...s,...i,e+"; return ["+i.join(",")+"];").bind({})}getObservablesKeys(e){const t=[...Object.keys(this.methods),...Object.keys(this.$),...Object.keys(e.$self.scope)];return t.push(e.$self.forBox.keyName||this.keyName),t.push(e.$self.forBox.valueName||this.valueName),t}getCSSObservablesKeys(){return[...Object.keys(this.methods),...Object.keys(this.$css)]}getObservablesValues(e){const t=[...Object.values(this.methods),...Object.values(this.$),...Object.values(e.$self.scope)];return t.push(e.$self.forBox.key),t.push(e.$self.forBox.value),t}getCSSObservablesValues(){return[...Object.values(this.methods),...Object.values(this.$css)]}setMutationObserver(e){window.__dito.mutationObserve(e)}debounce(e,t=10){let s;return(...i)=>{clearTimeout(s),"clear"!==i[0]&&(s=setTimeout((()=>{e.apply(this,i)}),t))}}}export{DitoElement};
